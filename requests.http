### ===== SELECCIONAR BACKEND =====
@base = https://TU-BACKEND.railway.app
# @base = http://127.0.0.1:8082

@json = application/json

### Health
GET {{base}}/health

### Providers
GET {{base}}/api/providers

### Connect WhatsApp (mock)
POST {{base}}/api/providers/whatsapp/connect
Content-Type: {{json}}

{
  "credentials": { "token": "TEST" }
}

### Recipes
GET {{base}}/api/flows/recipes


### Crear Flow (desde wizard)
# @name createFlow
POST {{base}}/api/flows/create
Content-Type: {{json}}

{
  "name": "Demo Prod",
  "trigger": "crm.lead.created",
  "steps": [
    { "type": "whatsapp.send", "template_id": "welcome", "to": "{{lead.assigned.phone}}" },
    { "type": "task.create", "assignee": "natali", "due": "+2d" }
  ]
}

> {%
/**
 * Guarda el id del flow creado para usarlo en Publish.
 * (VS Code REST Client)
 */
try {
  const data = JSON.parse(response.body);
  if (data && data.id) {
    client.global.set("flow_id", data.id);
    client.log("flow_id guardado: " + data.id);
  } else {
    client.log("No se pudo leer flow_id del response");
  }
} catch (e) {
  client.log("Error parseando response: " + e.message);
}
%}


### Publicar Flow (usa {{flow_id}})
POST {{base}}/api/flows/publish
Content-Type: {{json}}

{
  "flow_id": "{{flow_id}}"
}


### Emitir trigger (simula crm.lead.created)
POST {{base}}/api/triggers/emit
Content-Type: {{json}}

{
  "event": "crm.lead.created",
  "payload": {
    "lead": {
      "assigned": { "phone": "+5492610000000" },
      "id": "LEAD-TEST-1"
    }
  }
}


### Activity (Ãºltimos 10)
GET {{base}}/api/flow-runs?limit=10
